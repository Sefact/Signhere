<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.signhere.mapper.AuthentInter">
	<insert id="insNewCompany" parameterType = "CompanyBean">
		INSERT INTO CM VALUES(#{cmCode},#{cmName})
	</insert>
	
	<insert id="insTmpDp" parameterType = "UserBean">
		INSERT INTO DP VALUES('N',#{cmCode},'미배정')
	</insert>
	
	<insert id="JoinRequest" parameterType="UserBean">
		INSERT INTO MM VALUES(#{userId},#{userPwd},'N','V',#{cmCode},#{userName},#{userMail},'0','Y')
	</insert>
	
	<select id="getLogInInfo" parameterType="AccessBean" resultType="AccessBean"> 
		SELECT MM.ID AS userId, 
       MM.PW AS userPwd, 
       MM.NAME AS userName,
       MM.PWINITIAL as pwInitial, 
       MM.COMPANY_CODE AS cmCode,
       CM.COMPANY_NAME AS cmName,
       GR.GRADE_NAME AS grName,
       DP.DEPARTMENT_NAME AS dpName,
       DP.DEPARTMENT_CODE AS dpCode,
       MM.ADMIN as admin      
       FROM MM  INNER JOIN CM ON MM.COMPANY_CODE=CM.COMPANY_CODE
       INNER JOIN GR ON GR.GRADE_CODE=MM.GRADE_CODE
       INNER JOIN DP ON DP.COMPANY_CODE=MM.COMPANY_CODE 
       AND DP.DEPARTMENT_CODE = MM.DEPARTMENT_CODE
       WHERE ID=#{userId}
	</select>
	
	<insert id ="updateUserLog" parameterType ="AccessBean">
		INSERT INTO AH VALUES(SYSDATE,#{pwInitial},'1',#{privateIp},#{userId},#{cmCode},#{browser})
	</insert>
	
		<insert id ="updateUserLogOut" parameterType ="AccessBean">
		INSERT INTO AH VALUES(SYSDATE,#{pwInitial},'0',#{privateIp},#{userId},#{cmCode},#{browser})
	</insert>
	
	<update id="updateNewInfo" parameterType="UserBean">
	
		UPDATE MM SET MAIL=#{userMail}, PW=#{userPwd}, PWINITIAL='1'  WHERE ID =#{userId}
	
	</update>
	
	
</mapper>